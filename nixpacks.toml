[phases.setup]
# Asegura node, npm y pm2 en el entorno de build y runtime
packages = ["nodejs", "npm", "pm2"]

[phases.build]
# Verifica si las dependencias están instaladas, si no, las instala
commands = [
  "npm list next || npm ci --prefix .",  # Verifica si 'next' está instalado, si no lo está, lo instala
  "npm list dotenv || npm ci --prefix .",  # Verifica si 'dotenv' está instalado, si no lo está, lo instala
  "npm run build --prefix .",  # Luego, ejecuta el build del frontend
  "npm ci --prefix AdministracionPV",  # Instala dependencias de AdminJS
  "npm run generate --prefix AdministracionPV"  # Genera Prisma Client
]

[phases.start]
# Verifica si pm2 está instalado y ejecuta pm2-runtime para arrancar las aplicaciones
commands = [
  "npx pm2-runtime ecosystem.config.js"  # Utiliza npx para ejecutar pm2-runtime
]

[env]
# Define la URL interna donde corre AdminJS
NEXT_PUBLIC_ADMIN_URL = "http://localhost:8080"
NODE_ENV = "production"
PORT = "3000"
