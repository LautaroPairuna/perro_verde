[phases.setup]
# Asegura node, npm y pm2 en el entorno de build y runtime
packages = ["nodejs", "npm", "pm2"]

[phases.build]
# Verifica si las dependencias están instaladas, si no, las instala
commands = [
  "echo 'Verificando dependencias del frontend...'",
  "cd /app && npm install --legacy-peer-deps",  # Instalar dependencias del frontend, asegurando compatibilidad
  "echo 'Verificando dependencias de AdminJS...'",
  "cd /app/AdministracionPV && npm install --legacy-peer-deps",  # Instalar dependencias de AdminJS, asegurando compatibilidad
  "echo 'Ejecutando build del frontend...'",
  "npm run build --prefix .",  # Luego, ejecuta el build del frontend
  "echo 'Generando Prisma client...'",
  "npm run generate --prefix AdministracionPV"  # Genera Prisma Client
]

[phases.start]
# Verifica si pm2 está instalado y ejecuta pm2-runtime para arrancar las aplicaciones
commands = [
  "echo 'Iniciando aplicaciones con pm2-runtime...'",
  "npx pm2-runtime ecosystem.config.js"  # Utiliza npx para ejecutar pm2-runtime
]

[env]
# Define la URL interna donde corre AdminJS
NEXT_PUBLIC_ADMIN_URL = "http://localhost:8080"
NODE_ENV = "production"
PORT = "3000"
