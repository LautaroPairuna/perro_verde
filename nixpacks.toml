[phases.setup]
# Asegura node, npm y pm2 en el entorno de build y runtime
packages = ["nodejs", "npm"]

[phases.build]
# Instala y build de Next.js
commands = [
  "npm ci --prefix .",
  "npm run build --prefix .",
  "npm ci --prefix AdministracionPV",
  "npm run generate --prefix AdministracionPV"
]

[phases.start]
# Ejecuta pm2-runtime con npx
commands = [
  "export PATH=$PATH:$(npm bin -g)",  # Asegúrate de añadir el binario global de npm
  "npx pm2-runtime ecosystem.config.js"  # Usa npx para ejecutar pm2
]

[env]
# Define la URL interna donde corre AdminJS
NEXT_PUBLIC_ADMIN_URL = "http://localhost:8080"
NODE_ENV = "production"
PORT = "3000"
